map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)
#load all functions
devtools::load_all()
#map transects: Figure 1
map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)
#load all functions
devtools::load_all()
#map transects: Figure 1
map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)
#load all functions
devtools::load_all()
#map transects: Figure 1
map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)
remotes::install_github("paleolimbot/ggspatial")
#load all functions
devtools::load_all()
#map transects: Figure 1
map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)
#add scalebar
ggsn::scalebar(data = NULL, dist = 2.5, transform = TRUE, model = "WGS84", dist_unit = "km", height = 0.3,
x.min = 165.20, x.max = 165.30, y.min = -21.633, y.max = -21.640,
st.dist = 0.5, st.color = "white", box.color = "white", border.size = 0.5, box.fill = c("white", "white"), st.size = 3.4) +
#north arrow
ggspatial::annotation_north_arrow(location = "bl", which_north = "true",
height = grid::unit(1, "cm"),  width = grid::unit(1, "cm"),
style = ggspatial::north_arrow_orienteering(line_col = "white"),
text_col = "white") +
#map transects: Figure 1
map_transects_scalebar_mpa(maplatlon_sm, lines1, mpa_poe, "small", lat1_sm, lon1_sm, lat2_sm, lon2_sm,
dist = 2, offset_lon = 0.07, offset_lat = 0.01)+++
jj
#load all functions
devtools::load_all()
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
#with coastline instead of OSM for better view of images: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
#load all functions
devtools::load_all()
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
#with coastline instead of OSM for better view of images: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
maplatlon=maplatlon_sm; pa=mpa_poe;cor=allen_coral_poly; extent="small"; lon1=lon1_sm; lon2=lon2_sm; lat1=lat1_sm; lat2=lat2_sm
#crop coral polygons to osm extent
cor2 = raster::crop(cor, raster::extent(maplatlon$bbox$p1[1], maplatlon$bbox$p2[1],
maplatlon$bbox$p2[2], maplatlon$bbox$p1[2]))
#fortify coral polygons
cor3 = cor2 %>%
ggplot2::fortify(region = "class")
#fortify mpa polygon
pa2 = pa %>%
ggplot2::fortify(region = "NAME")
#read nc land (projection is Lambert new caledonia so needs reproject)
land = sf::st_read(here::here("data", "nc_land", "NOUVELLE_CALEDONIE.shp"))
sf::st_crs(land) <- 3163
land = sf::st_transform(land,  crs = 4326)
ggplot2::ggplot(land) +
#land
ggplot2::geom_sf(fill = "dark grey", color = "dark grey") +
#correction for land
# ggplot2::geom_rect(ggplot2::aes(xmin = 165.26, xmax = 165.3, ymin = -21.54, ymax = -21.52), fill = "dark grey") +
#add open sea category in light blue
ggplot2::geom_rect(ggplot2::aes(xmin = 165.225, xmax = 165.45, ymin = -21.65, ymax = -21.62), fill = "light blue") +
ggplot2::geom_rect(ggplot2::aes(xmin = 165.225, xmax = 165.35, ymin = -21.62, ymax = -21.595), fill = "light blue") +
ggplot2::geom_rect(ggplot2::aes(xmin = 165.225, xmax = 165.25, ymin = -21.595, ymax = -21.52), fill = "light blue") +
ggplot2::geom_rect(ggplot2::aes(xmin = 165.25, xmax = 165.255, ymin = -21.60, ymax = -21.57), fill = "light blue") +
ggplot2::geom_rect(ggplot2::aes(xmin = 165.25, xmax = 165.28, ymin = -21.60, ymax = -21.587), fill = "light blue") +
#add coral polygon
ggplot2::geom_polygon(data = cor3, ggplot2::aes(x = long, y = lat, group = group, fill = id)) +
#zoom on poe
ggplot2::scale_x_continuous(limits = c(lon1, lon2), expand = c(0, 0)) +
ggplot2::scale_y_continuous(limits = c(lat2, lat1), expand = c(0.0001, 0.0001)) +
#scale bar
ggplot2::scale_fill_manual(values = rev(colorspace::qualitative_hcl(length(unique(cor3$id)), c = 70, l = 50))) +
#add mpa
ggplot2::geom_polygon(data = pa2, ggplot2::aes(x = long, y = lat), col = "yellow", size = 0.6, alpha = 0) +
#plot parameters
ggplot2::theme(legend.text = ggplot2::element_text(size = 13),
legend.key.size = ggplot2::unit(1.15,"line"),
legend.position = "bottom",
axis.title.x =  ggplot2::element_blank(),
axis.title.y =  ggplot2::element_blank(),
axis.text = ggplot2::element_blank(),
axis.ticks = ggplot2::element_blank(),
panel.grid.major = ggplot2::element_blank(),
panel.grid.minor = ggplot2::element_blank()) +
ggplot2::labs(fill = "")
#load all functions
devtools::load_all()
###### Make map of Allen coral geomorphology polygons with added open sea category: Figure 3A
map_allen_coral_poly_coastline_with_open_sea(maplatlon_sm, mpa_poe, allen_coral_poly, "small", lon1_sm, lon2_sm, lat1_sm, lat2_sm)
#update NAMESPACE and add .Rd file for each function in man folder
devtools::document()
#load all functions
devtools::load_all()
#Map nbr survey with sightings per grid with image
#with coastline instead of OSM for better view of images: Appendix 3
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Turtle", mpa_poe, img_Turtle)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Shark", mpa_poe, img_Shark)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Round_ray", mpa_poe, img_Round_ray)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray)
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
#with coastline instead of OSM for better view of images: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray)
#load all functions
devtools::load_all()
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray)
#load all functions
devtools::load_all()
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
#with coastline instead of OSM for better view of images: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray)
#Map nbr survey with sightings per grid with image
#with coastline instead of OSM for better view of images: Appendix 3
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Turtle", mpa_poe, img_Turtle)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Shark", mpa_poe, img_Shark)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Round_ray", mpa_poe, img_Round_ray)
#load all functions
devtools::load_all()
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero
#with coastline instead of OSM for better view of images: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero_coastline(grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray)
#Map nbr survey with sightings per grid with image
#with coastline instead of OSM for better view of images: Appendix 3
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Dugong_certain", mpa_poe, img_Dugong_certain)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Turtle", mpa_poe, img_Turtle)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Shark", mpa_poe, img_Shark)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Round_ray", mpa_poe, img_Round_ray)
map_nbr_survey_with_sightings_per_grid_image_coastline(grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray)
#load all functions
devtools::load_all()
#mpa with image
barplot_density_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
############################################ DENSITY COMPARISONS #############################################################
#Make dataframe per grid cell centers (including empty cell centers) of observations, track length and densities per date and per species for POe
df_all_species = make_df_all_species_poe(grid_obs_per_date, grid_tracks_per_date, footprint_width)
# intersect density dataframe with coral and mpa status
# NB dataframe points are intersected with polygons
df_all_species_coral = intersect_df_allen_coral_poly(df_all_species, allen_coral_poly)
df_all_species_coral_mpa = intersect_df_mpa_allen_poly(df_all_species_coral, mpa_poe)
#mpa with image
barplot_density_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
#load all functions
devtools::load_all()
#mpa with image
barplot_density_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
#load all functions
devtools::load_all()
#Allen coral habitat and mpa with image
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
#load all functions
devtools::load_all()
#mpa with image
barplot_density_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
#Allen coral habitat and mpa with image
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
#load all functions
devtools::load_all()
#Allen coral habitat and mpa with image
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Dugong_certain", img_Dugong_certain)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Turtle", img_Turtle)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Shark", img_Shark)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Round_ray", img_Round_ray)
barplot_density_allen_coral_mpa_image(df_all_species_coral_mpa, "Eagle_ray", img_Eagle_ray)
ggplot2::xlab("Habitat class") +
ggplot2::ylab("Density") +
ggplot2::ggtitle(species_title) +
axis.title.x = ggplot2::element_text(size = 15),
#load all functions
devtools::load_all()
#Allen coral habitat with image
barplot_density_allen_coral_image(df_all_species_allen_coral, "Dugong_certain", img_Dugong_certain)
barplot_density_allen_coral_image(df_all_species_allen_coral, "Turtle", img_Turtle)
barplot_density_allen_coral_image(df_all_species_allen_coral, "Shark", img_Shark)
barplot_density_allen_coral_image(df_all_species_allen_coral, "Round_ray", img_Round_ray)
barplot_density_allen_coral_image(df_all_species_allen_coral, "Eagle_ray", img_Eagle_ray)
df_all_species_allen_coral
#Allen coral habitat with image
barplot_density_allen_coral_image(df_all_species_coral, "Dugong_certain", img_Dugong_certain)
barplot_density_allen_coral_image(df_all_species_coral, "Turtle", img_Turtle)
barplot_density_allen_coral_image(df_all_species_coral, "Shark", img_Shark)
barplot_density_allen_coral_image(df_all_species_coral, "Round_ray", img_Round_ray)
barplot_density_allen_coral_image(df_all_species_coral, "Eagle_ray", img_Eagle_ray)
#load all functions
devtools::load_all()
#black
img_Dugong_certain = read_megafauna_image("Dugong_certain")
img_Turtle = read_megafauna_image("Turtle")
img_Shark = read_megafauna_image("Shark")
img_Round_ray = read_megafauna_image("Round_ray")
img_Eagle_ray = read_megafauna_image("Eagle_ray")
#grey
img_Dugong_certain_grey = read_megafauna_image_grey("Dugong_certain")
img_Turtle_grey = read_megafauna_image_grey("Turtle")
img_Shark_grey = read_megafauna_image_grey("Shark")
img_Round_ray_grey = read_megafauna_image_grey("Round_ray")
img_Eagle_ray_grey = read_megafauna_image_grey("Eagle_ray")
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
#Map species densities per grid cell (all dates) with mpa overlaid and with megafauna image LOG with zero: Figure 4 A-E
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Turtle", mpa_poe, img_Turtle_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Shark", mpa_poe, img_Shark_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Round_ray", mpa_poe, img_Round_ray_grey)
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Dugong_certain", mpa_poe, img_Dugong_certain_grey)
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Turtle", mpa_poe, img_Turtle_grey)
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Shark", mpa_poe, img_Shark_grey)
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Round_ray", mpa_poe, img_Round_ray_grey)
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_nbr_survey_with_sightings_per_grid_image(maplatlon_sm_proj, grid_tracks_per_date, grid_obs_per_date, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
#load all functions
devtools::load_all()
map_dens_per_grid_species_poe_with_megafauna_image_log_with_zero(maplatlon_sm_proj, grid_obs_per_date, grid_tracks_per_date, footprint_width, "Eagle_ray", mpa_poe, img_Eagle_ray_grey)
grid_tracks_per_date
df_all_species_coral
View(df_all_species_coral)
df_all_species_coral$length
sum(df_all_species_coral$length, by = df_all_species_coral$class)
df_all_species_coral %>%
dplyr::select(length, class) %>%
dplyr::group_by(class)
df_all_species_coral %>%
dplyr::select(length, class) %>%
dplyr::group_by(class) %>%
dplyr::summarise(sum = sum(length))
df_all_species_coral %>%
dplyr::select(length, class) %>%
dplyr::group_by(class) %>%
dplyr::summarise(sum = sum(length)) -> dat
dat$sum / sum(dat$sum)
dat$sum / sum(dat)
#effort per habitat class
df_all_species_coral %>%
dplyr::select(length, class) %>%
dplyr::group_by(class) %>%
dplyr::summarise(sum = sum(length)) -> dat
dat$sum / sum(dat)
dat$sum / sum(dat$sum)
100*(dat$sum / sum(dat$sum))
dat$percent <- 100*(dat$sum / sum(dat$sum))
dat
#effort in/out mpa
df_all_species_coral %>%
dplyr::select(length, mpa_status) %>%
dplyr::group_by(mpa_status) %>%
dplyr::summarise(sum = sum(mpa_status)) -> dat
dat$percent <- 100*(dat$sum / sum(dat$sum))
#effort in/out mpa
df_all_species_coral_mpa %>%
dplyr::select(length, mpa_status) %>%
dplyr::group_by(mpa_status) %>%
dplyr::summarise(sum = sum(mpa_status)) -> dat
dat$percent <- 100*(dat$sum / sum(dat$sum))
#effort in/out mpa
df_all_species_coral_mpa %>%
dplyr::select(length, mpa_status) %>%
dplyr::group_by(mpa_status) %>%
dplyr::summarise(sum = sum(length)) -> dat
dat$percent <- 100*(dat$sum / sum(dat$sum))
dat
100 - 17.5
#Allen coral habitat with image
barplot_density_allen_coral_image(df_all_species_coral, "Dugong_certain", img_Dugong_certain)
df=df_all_species_coral
species="Dugong_certain"
img=img_Dugong_certain
#mean density per coral hab for given species
df %>%
dplyr::mutate(density = get(paste0("density_", species))) %>%
dplyr::mutate(coral_hab = get(paste("class"))) %>%
dplyr::select(c(density, coral_hab)) %>%
dplyr::group_by(coral_hab) %>%
dplyr::summarize(mean = mean(density, na.rm=T),
sd = sd(density, na.rm=T),
se = sd / sqrt(length(density))) -> new
# convert back to spatial object for plotting
new = sf::as_Spatial(new)
# make dataframe for plotting
new = data.frame(mean_dens = new$mean,
sd_dens = new$sd,
se_dens = new$se,
coral_hab = as.factor(new$coral_hab))
#rename deep_Sea
levels(new$coral_hab) <- c("Coral/Algae", "Open Sea", "Microalgal Mats", "Rock", "Rubble", "Sand", "Seagrass")
new
ggplot2::ggplot(new, ggplot2::aes(x = coral_hab, y = mean_dens)) +
ggplot2::geom_col() +
ggplot2::xlab("Habitat class") +
ggplot2::ylim(c(0, ylim)) +
ggplot2::ylab("Density") +
ggplot2::ggtitle(species_title) +
ggplot2::theme(plot.title = ggplot2::element_text(hjust = 0.5),
axis.text.x = ggplot2::element_text(angle = 90, vjust=0.5, hjust=1, size =12),
axis.title.y = ggplot2::element_text(size = 15),
axis.title.x = ggplot2::element_text(size = 15),
panel.background = ggplot2::element_rect(fill = "white", colour = "black",size = 0.5, linetype = "solid"),
panel.grid.major.y = ggplot2::element_line(size = 0.5, linetype = 'dashed', colour = "grey"),
panel.grid.minor = ggplot2::element_line(size = 0.25, linetype = 'solid', colour = "white")) +
#add megafaune image
ggplot2::annotation_custom(grid::rasterGrob(img, interpolate=TRUE), xmin = a, xmax = b, ymin = c, ymax = d)
# parameters for image placement
if (species == "Dugong_certain"){
ylim = 0.016
a = 5
b = 7.8
c = 0.010
d = 0.018
species_title <- "Dugong"
}
if (species == "Turtle"){
ylim = 0.013
a = 5.4
b = 8.2
c = 0.010
d = 0.014
species_title <- "Sea turtle"
}
if (species == "Shark"){
ylim = 0.005
a = 5
b = 7.8
c = 0.0035
d = 0.0055
species_title <- "Shark"
}
if (species == "Round_ray"){
ylim = 0.012
a = 5.4
b = 8.3
c = 0.0085
d = 0.0125
species_title <- "Dasyatidae"
}
if (species == "Eagle_ray"){
ylim = 0.006
a = 5.4
b = 8
c = 0.004
d = 0.006
species_title <- "Myliobatidae"
}
# plot
p = ggplot2::ggplot(new, ggplot2::aes(x = coral_hab, y = mean_dens)) +
ggplot2::geom_col() +
ggplot2::xlab("Habitat class") +
ggplot2::ylim(c(0, ylim)) +
ggplot2::ylab("Density") +
ggplot2::ggtitle(species_title) +
ggplot2::theme(plot.title = ggplot2::element_text(hjust = 0.5),
axis.text.x = ggplot2::element_text(angle = 90, vjust=0.5, hjust=1, size =12),
axis.title.y = ggplot2::element_text(size = 15),
axis.title.x = ggplot2::element_text(size = 15),
panel.background = ggplot2::element_rect(fill = "white", colour = "black",size = 0.5, linetype = "solid"),
panel.grid.major.y = ggplot2::element_line(size = 0.5, linetype = 'dashed', colour = "grey"),
panel.grid.minor = ggplot2::element_line(size = 0.25, linetype = 'solid', colour = "white")) +
#add megafaune image
ggplot2::annotation_custom(grid::rasterGrob(img, interpolate=TRUE), xmin = a, xmax = b, ymin = c, ymax = d)
p
## Dugong interaction
make_pairwise_comparison_allen_coral_mpa(df_all_species_coral_mpa, "Dugong_certain")
df_all_species_coral_mpa
## Dugong interaction
make_pairwise_comparison_allen_coral_mpa(df_all_species_coral_mpa, "Dugong_certain")
## Dasyatidae habitat
make_pairwise_comparison_allen_coral(df_all_species_coral_mpa, "Round_ray")
## Dasyatidae interaction
make_pairwise_comparison_allen_coral_mpa(df_all_species_coral_mpa, "Round_ray")
# Make permanova for density per mpa status and coral habitat
perm_dug = make_permanova_allen_coral_mpa(df_all_species_coral_mpa, "Dugong_certain")
df=-df_all_species_coral_mpa
df=df_all_species_coral_mpa
df %>%
dplyr::mutate(allen_coral_hab = as.factor(get(paste("class")))) %>%
# delete na
dplyr::filter(!is.na(density_Dugong_certain), !is.na(density_Turtle), !is.na(density_Shark), !is.na(density_Round_ray), !is.na(density_Eagle_ray)) %>%
as.data.frame() -> df
#density taxa
if (species == "Dugong_certain") {
density_taxa = df$density_Dugong_certain
}
if (species == "Turtle") {
density_taxa = df$density_Turtle
}
if (species == "Shark") {
density_taxa = df$density_Shark
}
if (species == "Round_ray") {
density_taxa = df$density_Round_ray
}
if (species == "Eagle_ray") {
density_taxa = df$density_Eagle_ray
}
df %>%
dplyr::select(id, allen_coral_hab, mpa_status) -> df_env
#need to load library for the function to work (installed from devtools::install_github("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis"))
library(pairwiseAdonis)
density_taxa
#pairwise comp (need to replicate density_taxa column for the function to work)
comp <- pairwise.adonis2(cbind(density_taxa,density_taxa) ~ allen_coral_hab * mpa_status, data = df_env, permutations = 999, method = "euclidean")
species
comp
#load all functions
devtools::load_all()
## Dugong interaction
make_pairwise_comparison_allen_coral_mpa(df_all_species_coral_mpa, "Dugong_certain")
## Dasyatidae habitat
make_pairwise_comparison_allen_coral(df_all_species_coral_mpa, "Round_ray")
## Dugong interaction
comp_dug = make_pairwise_comparison_allen_coral_mpa(df_all_species_coral_mpa, "Dugong_certain")
comp_dug
